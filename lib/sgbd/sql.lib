###############################################################################
# sql.lib                                                      Version : 1.1  #
#                                                                             #
# Creation Date : 23/02/2007                                                  #
# Team          : Only me after all                                           #
# Support mail  : arnaud@crampet.net                                          #
# Author        : Arnaud Crampet                                              #
#                                                                             #
# Subject : This library provide base bdd automaintenance                     #
#                                                                             #
###############################################################################
####
# Info

function SQL_Server_Connect
{
############ STACK_TRACE_BUILDER #####################
Function_Name="${0}"
Function_PATH="${Function_PATH}/${Function_Name}"
######################################################
MSG_DISPLAY "Debug4" "Current Stack : [ ${Function_PATH} ] "

INTERNAM_ITERAT_SQL_CONNECT="0"

case ${EXTERNAL_SQL_IS_CONNECTED} in
            OnLine) MSG_DISPLAY "Info" "SQL Session id ${EXTERNAL_SQL_session_ID} status : [ Allready connected ] "
                           ;;
            OffLine) MSG_DISPLAY "Info" "SQL Session id ${EXTERNAL_SQL_session_ID} status : [ Not connected ] "
                     SYSTEM_VAR_RANDOMIZER
                     EXTERNAL_SQL_current_FIFO_file="${Base_SQL_Fifo_FileName}_${EXTERNAL_randomized_var}"
                     EXTERNAL_SQL_current_Log_File="${Base_SQL_Log_FileName}_${EXTERNAL_randomized_var}"
                     MSG_DISPLAY "Debug6" "Current SQL FIFO file : [ ${EXTERNAL_SQL_current_FIFO_file} ] "
                     MSG_DISPLAY "Debug6" "Current SQL Log file : [ ${EXTERNAL_SQL_current_Log_File} ] "
                     SQL_Sub_connect_Server
                     FIFO_CREATE SQL_fifo filename="${EXTERNAL_SQL_current_FIFO_file}"
                     ${Base_mysql_bin_proc_use} < ${EXTERNAL_SQL_current_FIFO_file} > ${EXTERNAL_SQL_current_Log_File} &
                     echo $?
                     EXTERNAL_SQL_IS_CONNECTED="OnLine"
                     EXTERNAL_SQL_session_ID="${EXTERNAL_randomized_var}"
                     MSG_DISPLAY "Info" "SQL Session id ${EXTERNAL_SQL_session_ID} status : [ connected ] "
                     ;;
                  *) MSG_DISPLAY "ErrorN" "Internal Error in function var  : [ EXTERNAL_SQL_IS_CONNECTED ]" "1"
                     ;;
esac
############### Stack_TRACE_BUILDER ################
Function_PATH="$( dirname ${Function_PATH} )"
####################################################
}


function SQL_Server_Disconnect
{
############ STACK_TRACE_BUILDER #####################
Function_Name="${0}"
Function_PATH="${Function_PATH}/${Function_Name}"
######################################################
MSG_DISPLAY "Debug4" "Current Stack : [ ${Function_PATH} ] "
case ${EXTERNAL_SQL_IS_CONNECTED} in
     OnLine) MSG_DISPLAY "Debug6" "SQL Session id ${EXTERNAL_SQL_session_ID} status : [ Connected ] "
             MSG_DISPLAY "Debug6" "Current SQL FIFO file : [ ${EXTERNAL_SQL_current_FIFO_file} ] "
             MSG_DISPLAY "Debug6" "Current SQL Log file : [ ${EXTERNAL_SQL_current_Log_File} ] "
             printf -- " exit " > ${EXTERNAL_SQL_current_FIFO_file}
             sleep 2
             FIFO_DELETE SQL_fifo
             MSG_DISPLAY "Debug6" "SQL Session id ${EXTERNAL_SQL_session_ID} status : [ Disconnected ] "
             EXTERNAL_SQL_IS_CONNECTED="OffLine"
             ;;
    OffLine) MSG_DISPLAY "Info" "SQL Session id ${EXTERNAL_SQL_session_ID} status : [ Not connected ] "
             MSG_DISPLAY "Info" "you con't disconnect an not connected session "
             ;;
esac
############### Stack_TRACE_BUILDER ################
Function_PATH="$( dirname ${Function_PATH} )"
####################################################
}

function SQL_DATABASE_connect
{
#|# DATABASE_To_connect     : Use this var to set on witch database yuou want to connect
#|# ${1}                    :  use this var to set DATABASE_To_connect
############ STACK_TRACE_BUILDER #####################
Function_Name="${0}"
Function_PATH="${Function_PATH}/${Function_Name}"
######################################################
MSG_DISPLAY "Debug4" "Current Stack : [ ${Function_PATH} ] "
DATABASE_To_connect="${1}"

printf -- " CONNECT ${DATABASE_To_connect}; " >> ${EXTERNAL_SQL_current_FIFO_file}
printf -- " show tables ; " >> ${EXTERNAL_SQL_current_FIFO_file}
############### Stack_TRACE_BUILDER ################
Function_PATH="$( dirname ${Function_PATH} )"
####################################################
}

function SQL_CONNECT_CHECK
{
############ STACK_TRACE_BUILDER #####################
Function_Name="${0}"
Function_PATH="${Function_PATH}/${Function_Name}"
######################################################
MSG_DISPLAY "Debug4" "Current Stack : [ ${Function_PATH} ] "

if [ ${EXTERNAL_SQL_IS_CONNECTED} = "OnLine" ]
   then
          MSG_DISPLAY "Debug6" "Connection to DATABASE server : [ OK ] "
   else
          MSG_DISPLAY "errorN" "Connection to DATABASE server : [ not Connected] " "0"
          MSG_DISPLAY "errorN" "Please ensure you have called  function  [ SQL_Server_Connect  ]  " "1"
fi
############### Stack_TRACE_BUILDER ################
Function_PATH="$( dirname ${Function_PATH} )"
####################################################
}

function SQL_GET_PKG_liste
{
#|# Base_Database_Type
#|# Base_Database_Host
#|# Base_Database_Port
#|# Base_Database_proc_Username
#|# Base_Database_TempDir
#|# Base_Database_Default
#|# packageTable="ARPCOM_PKG_CAT"
#|# typePackageTable="ARPCOM_PKG_TYPE_CAT"
#|# omImportTable="ARPCOM_OM_IMPORT"
############ STACK_TRACE_BUILDER #####################
Function_Name="${0}"
Function_PATH="${Function_PATH}/${Function_Name}"
######################################################
MSG_DISPLAY "Debug4" "Current Stack : [ ${Function_PATH} ] "
SYSTEM_VAR_RANDOMIZER
INTERNAL_ID_READ_ITEM="#-#-${EXTERNAL_randomized_var}"

SQL_CMD="select DISTINCT '${INTERNAL_ID_READ_ITEM}' as 'BACKTRACE', \`PKG_NAME\`,\`ID_PKG\`  FROM  \`${Base_Database_Default}\`.\`${packageTable}\` ; "


printf -- "select '${INTERNAL_ID_READ_ITEM}' as 'BACKTRACE', 'Debut' as 'status' ; " >> ${EXTERNAL_SQL_current_FIFO_file}
printf -- "${SQL_CMD}" >> ${EXTERNAL_SQL_current_FIFO_file}
printf -- "select '${INTERNAL_ID_READ_ITEM}' as 'BACKTRACE', 'fin' as 'status' ; " >> ${EXTERNAL_SQL_current_FIFO_file}
SQL_Server_Disconnect

############### Stack_TRACE_BUILDER ################
Function_PATH="$( dirname ${Function_PATH} )"
####################################################
}

function SQL_USE_PKG_liste
{
for PKGS in $( cat ${EXTERNAL_SQL_current_Log_File} | grep ${INTERNAL_ID_READ_ITEM} | awk  '{print  $2 "|" $3 }' ) 
   do 
   	 INTERNAL_VALUS_STATUS="$(print  "${PKGS} " | awk -F\| '{print $1}')"
   	 case ${INTERNAL_VALUS_STATUS} in 
   	                  debut) MSG_DISPLAY "Debug4" "Internal ddb proc generator  : [ Start ] " 
   	                         ;;
                        fin) MSG_DISPLAY "Debug4" "Internal ddb proc generator  : [ done ] " 
                             ;;
                          *) SQL_Server_Connect
                             SQL_DATABASE_connect "ARPCOM"
                             print  "${PKGS} " | awk -F\| '{print $1 " " $2 }'
                             INTERNAL_PKG_NAME="$(print  "${PKGS} " | awk -F\| '{ print $1 }')"
                             INTERNAL_LAST_do_action="${INTERNAL_LAST_do_action}"
                             PROC_NAME="${Base_PROC_Name}_${INTERNAL_PKG_NAME}"
                             TABLE_NAME="${Base_TABLE_Name}_${INTERNAL_PKG_NAME}"
                             MSG_DISPLAY "Debug5" "Table Name : [ ${TABLE_NAME} ] "
                             MSG_DISPLAY "Debug5" "Procedure Name : [ ${PROC_NAME} ] "
                             SQL_GENERATE_PROCS_OM_PKG_KEY_CATALOGUE >> ${EXTERNAL_SQL_current_FIFO_file} &
                             SQL_Server_Disconnect
                             ;;
  ${INTERNAL_LAST_do_action}) MSG_DISPLAY "Debug4" "Package ${INTERNAL_LAST_do_action} : [ Allready done ] "
                             ;;
       esac
done 

}

function TITI
{
${Base_mysql_bin_proc_use} < ${INTERNAL_IN_FILE} > ${INTERNAL_OUT_FILE}
cat ${EXTERNAL_SQL_current_Log_File} | egrep -v "PKG_NAME" | grep  "\." > ${INTERNAL_OUT_FILE}.tmp.nok
cat ${EXTERNAL_SQL_current_Log_File} | egrep -v "PKG_NAME" |egrep -v "\."   > ${INTERNAL_OUT_FILE}.tmp


cat ${INTERNAL_OUT_FILE}.tmp > ${INTERNAL_OUT_FILE}

cat  ${INTERNAL_OUT_FILE} | while read line
do  INTERNAL_PKG_NAME="$( echo  "$line" | awk '{ print $1 }')"
    INTERNAL_PKD_ID="$( echo "$line" | awk '{ print $2 }')"
    
 
    SQL_GENERATE_PROC >> ${SQL_MASTER_PROC_SCRIPT}
    SQL_Run_ALL_PROCS_GEN_SUB1 > ${INTERNAL_IN_FILE}_RUN_PROCS.tmp

done
printf -- " exit "  > ${INTERNAL_IN_FILE}_RUN_PROCS.tmp
rm ${INTERNAL_IN_FILE}_RUN_PROCS.tmp
#${Base_mysql_bin_proc_use} < ${SQL_MASTER_PROC_SCRIPT}

############### Stack_TRACE_BUILDER ################
Function_PATH="$( dirname ${Function_PATH} )"
####################################################
}


function SQL_GENERATE_PROCS_OM_PKG_KEY_CATALOGUE
{
#|# Base_Database_Type
#|# Base_Database_Host
#|# Base_Database_Port
#|# Base_Database_proc_Username
#|# Base_Database_TempDir
#|# Base_Database_Default
#|# packageTable="ARPCOM_PKG_CAT"
#|# typePackageTable="ARPCOM_PKG_TYPE_CAT"
#|# omImportTable="ARPCOM_OM_IMPORT"
############ STACK_TRACE_BUILDER #####################
Function_Name="${0}"
Function_PATH="${Function_PATH}/${Function_Name}"
######################################################
MSG_DISPLAY "Debug4" "Current Stack : [ ${Function_PATH} ] "

printf -- "DELIMITER \$\$"
printf -- "DROP PROCEDURE IF EXISTS \`${Base_Database_Default}\`.\`${PROC_NAME}\`\$\$"
printf -- "CREATE DEFINER=\`admdb\`@\`%\` PROCEDURE \`${PROC_NAME}\`"
printf -- "(  versionGeneral varchar(16)"
printf -- " , versionRelease  varchar(16)"
printf -- " , versionCorrectif varchar(16)"
printf -- " , versionPatch varchar(16)"
printf -- " , nomPF varchar(16)"
printf -- " , nomMachine varchar(16)"
printf -- " , nomInstance varchar(16)"
printf -- " , nomInstanceSub1 varchar(50)"
printf -- " , nomInstanceSub2 varchar(50)"
printf -- " , numstage varchar(32)"
printf -- ")"
printf -- "BEGIN"
printf -- ""
printf -- "DROP TABLE IF EXISTS  \`${Base_Database_Default}\`.\`${Base_TABLE_Name}_${INTERNAL_PKG_NAME}\`;"
printf -- "CREATE TABLE IF NOT EXISTS  \`${Base_Database_Default}\`.\`${Base_TABLE_Name}_${INTERNAL_PKG_NAME}\` ("
printf -- "  \`ID_PKG\`               int(11)       NOT NULL,"
printf -- "  \`PKG_GENERAL\`          varchar(8)    NOT NULL,"
printf -- "  \`PKG_RELEASE\`          varchar(8)    NOT NULL,"
printf -- "  \`PKG_CORRECTIF\`        varchar(8)    NOT NULL,"
printf -- "  \`PKG_PATCH\`            varchar(8)    default NULL,"
printf -- "  \`keywords_root_path\`   varchar(32)   default 'INFRA',"
printf -- "  \`keywords_level1_PATH\` varchar(32)   default NULL,"
printf -- "  \`keywords_level2_PATH\` varchar(32)   default NULL,"
printf -- "  \`keywords_level3_PATH\` varchar(32)   default NULL,"
printf -- "  \`keywords_level4_PATH\` varchar(32)   default NULL,"
printf -- "  \`keywords_level5_PATH\` varchar(32)   default NULL,"
printf -- "  \`keywords_level6_PATH\` varchar(32)   default NULL,"
printf -- "  \`Keyword_Name\`         varchar(100)  NOT NULL,"
printf -- "  \`Keyword_Value\`        varchar(2142) default NULL,"
printf -- "  \`stage\`                varchar(32)   default NULL,"
printf -- "  PRIMARY KEY  (\`Keyword_Name\`)"
printf -- ") ENGINE=MyISAM DEFAULT CHARSET=latin1 ;"
printf -- ""

SQL_Sub_GENERATE_PROCS_OM_PKG_KEY_CATALOGUE_1

printf -- "SELECT  \`${Base_Database_Default}_PKG_CAT\`.\`ID_PKG\` AS 'ID_PKG'"
printf -- "       ,\`PKG_GENERAL\`"
printf -- "       ,\`PKG_RELEASE\`"
printf -- "       ,\`PKG_CORRECTIF\`"
printf -- "       ,\`PKG_PATCH\`"
printf -- "       ,'INFRA' AS 'keywords_root_path'"
printf -- "       ,'' AS 'keywords_level1_PATH'"
printf -- "       ,'' AS 'keywords_level2_PATH'"
printf -- "       ,'' AS 'keywords_level3_PATH'"
printf -- "       ,'' AS 'keywords_level4_PATH'"
printf -- "       ,'' AS 'keywords_level5_PATH'"
printf -- "       ,'' AS 'keywords_level6_PATH'"
printf -- "       ,\`PKG_File_Keyword\` AS 'Keywod_Name'"
printf -- "       ,'' AS 'Keyword_Value'"
printf -- "       ,'' AS stage"
printf -- "     FROM  ( \`${Base_Database_Default}_PKG_CAT\` LEFT JOIN \`${Base_Database_Default}_PKG_FILE_CAT\`"
printf -- "         ON (\`${Base_Database_Default}_PKG_CAT\`.\`ID_PKG\` = \`${Base_Database_Default}_PKG_FILE_CAT\`.\`ID_PKG\`))"
printf -- "            WHERE \`PKG_NAME\`    =  '${INTERNAL_PKG_NAME}' "
printf -- "               AND \`PKG_GENERAL\` =  \`versionGeneral\`"
printf -- "               AND \`PKG_RELEASE\` =  \`versionRelease\`"
printf -- "               AND \`PKG_CORRECTIF\` =  \`versionCorrectif\`"
printf -- "               AND \`PKG_PATCH\` = \`versionPatch\`"
printf -- "          ORDER BY  \`${Base_Database_Default}_PKG_FILE_CAT\`.\`PKG_File_Keyword\`;"
printf -- ""

SQL_Sub_GENERATE_PROCS_OM_PKG_KEY_CATALOGUE_1
SQL_Sub_GENERATE_PROCS_OM_PKG_KEY_CATALOGUE_2



printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level1_PATH\` = '' "
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level2_PATH\` = '' "
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level3_PATH\` = '' "
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level4_PATH\` = '' "
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level5_PATH\` = '' "
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`stage\` = \`numStage\` ; "
printf -- ""


SQL_Sub_GENERATE_PROCS_OM_PKG_KEY_CATALOGUE_1
SQL_Sub_GENERATE_PROCS_OM_PKG_KEY_CATALOGUE_2


printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level1_PATH\` = \`nomMachine\`"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level2_PATH\` = ''"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level3_PATH\` = ''"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level4_PATH\` = ''"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level5_PATH\` = ''"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`stage\` = \`numStage\` ;"
printf -- ""
SQL_Sub_GENERATE_PROCS_OM_PKG_KEY_CATALOGUE_1
SQL_Sub_GENERATE_PROCS_OM_PKG_KEY_CATALOGUE_2


printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level1_PATH\` = \`nomMachine\`"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level2_PATH\` = '${INTERNAL_PKG_NAME}'"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level3_PATH\` = ''"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level4_PATH\` = ''"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level5_PATH\` = ''"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`stage\` = \`numStage\` ;"
printf -- ""

SQL_Sub_GENERATE_PROCS_OM_PKG_KEY_CATALOGUE_1
SQL_Sub_GENERATE_PROCS_OM_PKG_KEY_CATALOGUE_2

printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level1_PATH\` = \`nomMachine\`"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level2_PATH\` = '${INTERNAL_PKG_NAME}'"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level3_PATH\` = \`nomInstance\`"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level4_PATH\` = ''"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level5_PATH\` = ''"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`stage\` = \`numStage\` ;"
printf -- ""

SQL_Sub_GENERATE_PROCS_OM_PKG_KEY_CATALOGUE_1
SQL_Sub_GENERATE_PROCS_OM_PKG_KEY_CATALOGUE_2


printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level1_PATH\` = \`nomMachine\`"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level2_PATH\` = '${INTERNAL_PKG_NAME}'"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level3_PATH\` = \`nomInstance\`"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level4_PATH\` = \`nomInstanceSub1\`"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level5_PATH\` = ''"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`stage\` = \`numStage\` ;"
printf -- ""

SQL_Sub_GENERATE_PROCS_OM_PKG_KEY_CATALOGUE_1
SQL_Sub_GENERATE_PROCS_OM_PKG_KEY_CATALOGUE_2


printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level1_PATH\` = \`nomMachine\`"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level2_PATH\` = '${INTERNAL_PKG_NAME}' "
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level3_PATH\` = \`nomInstance\`"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level4_PATH\` = \`nomInstanceSub1\`"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level5_PATH\` = \`nomInstanceSub2\`"
printf -- "            AND \`${Base_Database_Default}_OM_IMPORT\`.\`stage\` = \`numStage\` ;"
printf -- "END\$\$"
printf -- "DELIMITER ;"

############### Stack_TRACE_BUILDER ################
Function_PATH="$( dirname ${Function_PATH} )"
####################################################
}

function SQL_Sub_GENERATE_PROCS_OM_PKG_KEY_CATALOGUE_1
{
printf -- "REPLACE into \`${Base_Database_Default}\`.\`${Base_TABLE_Name}_${INTERNAL_PKG_NAME}\`"
printf -- "   (\`ID_PKG\`"
printf -- "   ,\`PKG_GENERAL\`"
printf -- "   ,\`PKG_RELEASE\`"
printf -- "   ,\`PKG_CORRECTIF\`"
printf -- "   ,\`PKG_PATCH\`"
printf -- "   ,\`keywords_root_path\`"
printf -- "   ,\`keywords_level1_PATH\`"
printf -- "   ,\`keywords_level2_PATH\`"
printf -- "   ,\`keywords_level3_PATH\`"
printf -- "   ,\`keywords_level4_PATH\`"
printf -- "   ,\`keywords_level5_PATH\`"
printf -- "   ,\`keywords_level6_PATH\`"
printf -- "   ,\`Keyword_Name\`"
printf -- "   ,\`Keyword_Value\`"
printf -- "   ,\`stage\`"
printf -- ")"
}

function SQL_Sub_GENERATE_PROCS_OM_PKG_KEY_CATALOGUE_2
{
printf -- "SELECT \`ID_PKG\`"
printf -- "     ,\`PKG_GENERAL\`"
printf -- "      ,\`PKG_RELEASE\`"
printf -- "      ,\`PKG_CORRECTIF\`"
printf -- "      ,\`PKG_PATCH\`"
printf -- "      ,\`${Base_Database_Default}_OM_IMPORT\`.\`keywords_root_path\`"
printf -- "      ,\`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level1_PATH\`"
printf -- "      ,\`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level2_PATH\`"
printf -- "      ,\`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level3_PATH\`"
printf -- "      ,\`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level4_PATH\`"
printf -- "      ,\`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level5_PATH\`"
printf -- "      ,\`${Base_Database_Default}_OM_IMPORT\`.\`keywords_level6_PATH\`"
printf -- "      ,\`${Base_TABLE_Name}_${INTERNAL_PKG_NAME}\`.\`Keyword_Name\` AS \`Keyword_Name\`"
printf -- "      ,\`${Base_Database_Default}_OM_IMPORT\`.\`Keyword_Value\`"
printf -- "      ,\`${Base_Database_Default}_OM_IMPORT\`.\`stage\`"
printf -- " FROM ( \`${Base_TABLE_Name}_${INTERNAL_PKG_NAME}\` LEFT JOIN \`${Base_Database_Default}_OM_IMPORT\`"
printf -- "      ON ( \`${Base_Database_Default}_OM_IMPORT\`.\`Keyword_Name\` = \`${Base_TABLE_Name}_${INTERNAL_PKG_NAME}\`.\`Keyword_Name\` ))"
printf -- "         WHERE  \`${Base_Database_Default}_OM_IMPORT\`.\`keywords_root_path\` = 'INFRA'"
}


function SQL_Run_ALL_PROCS_GEN_SUB
{
############ STACK_TRACE_BUILDER #####################
Function_Name="${0}"
Function_PATH="${Function_PATH}/${Function_Name}"
######################################################
MSG_DISPLAY "Debug4" "Current Stack : [ ${Function_PATH} ] "
print "CALL \`PKG_proc_from_OM_ContentAdaptation\`( '${INTERNAL_GO}','${INTERNAL_RO}','${INTERNAL_CO}','${INTERNAL_PO}','${INTERNAL_PFNAME}','${INTERNAL_SERVER_NAME}','${INTERNAL_INST1}','${INTERNAL_INST2}','${INTERNAL_INST3}','${INTERNAL_STAGE}')"


############### Stack_TRACE_BUILDER ################
Function_PATH="$( dirname ${Function_PATH} )"
####################################################
}


function SQL_Run_ALL_PROCS
{
############ STACK_TRACE_BUILDER #####################
Function_Name="${0}"
Function_PATH="${Function_PATH}/${Function_Name}"
######################################################
MSG_DISPLAY "Debug4" "Current Stack : [ ${Function_PATH} ] "

SQL_Run_ALL_PROCS_GEN_SUB1 > ${INTERNAL_IN_FILE}_RUN_PROCS.tmp
${Base_mysql_bin_proc_use} < ${INTERNAL_IN_FILE}_RUN_PROCS.tmp >> ${INTERNAL_OUT_FILE}_TUN_PROCS.tmp


############### Stack_TRACE_BUILDER ################
Function_PATH="$( dirname ${Function_PATH} )"
####################################################
}

function SQL_GET_ALL_INFO_FOR_PROCS
{
############ STACK_TRACE_BUILDER #####################
Function_Name="${0}"
Function_PATH="${Function_PATH}/${Function_Name}"
######################################################
MSG_DISPLAY "Debug4" "Current Stack : [ ${Function_PATH} ] "

INTERNAL_IN_FILE_GET_ALL="${Base_Database_TempDir}/GET_ALL_tmp_in.sql"
INTERNAL_OUT_FILE_GET_ALL="${Base_Database_TempDir}/GET_ALL_outfile.file"
SQL_CMD="select * from \`ARPCOM_VIEW_PKG_FOR_PROC\` ;"

printf -- "${SQL_CMD}" EXTERNAL_SQL_current_FIFO_file
############### Stack_TRACE_BUILDER ################
Function_PATH="$( dirname ${Function_PATH} )"
####################################################
}


Sourced_OK="1"
